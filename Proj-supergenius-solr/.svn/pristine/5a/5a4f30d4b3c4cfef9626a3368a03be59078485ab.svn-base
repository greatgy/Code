$(function(a){a(document).ajaxStart(function(){a(".loading").removeClass("hd")});a(document).ajaxStop(function(){a(".loading").addClass("hd")});search()});function setDataDocHighlight(a,d){for(var b in d)a[b]=d[b][0]}
function dataHandling(a,d){for(var b in a.docs){var e=a.docs[b];setDataDocHighlight(e,d[e.uid])}for(b=0;b<a.docs.length;b++){"finance"==a.docs[b]._table_&&(a.docs[b].href="debate"==e.firstTypeName?"{0}/debate/article/{1}".format(financebase,a.docs[b].id):"{0}/{1}/{2}".format(financebase,a.docs[b].firstTypeName,a.docs[b].oid));"startup"==a.docs[b]._table_&&(a.docs[b].href="{0}/{1}/{2}/{3}".format(startupbase,"article",a.docs[b].cid,a.docs[b].oid));"ai"==a.docs[b]._table_&&(a.docs[b].href="{0}/{1}/{2}/{3}".format(aibase,
"article",a.docs[b].cid,a.docs[b].oid));"career"==a.docs[b]._table_&&(a.docs[b].href="problem"==a.docs[b].firstTypeName?"{0}/{1}/{2}/{3}".format(careerbase,"puzzled","detail",a.docs[b].oid):"{0}/{1}/{2}/{3}".format(careerbase,"article",a.docs[b].cid,a.docs[b].oid));if(""==a.docs[b].summary||null==a.docs[b].summary||"undefined"==a.docs[b].summary){var c=a.docs[b].content;a.docs[b].summary=100>=c.length?c:c.substring(0,100)+"......"}c=a.docs[b].summary;100<c.length&&(a.docs[b].summary=c.substring(0,
100)+"......")}return a}
function search(){$(".loading").removeClass("hd");client.search(PageData.searchword,{start:0,table:PageData.table,rows:PageData.pagesize,sort:PageData.sort},function(a){$(".loading").addClass("hd");if(a.response.numFound>PageData.pagesize)$(".load").removeClass("hd"),$.fn.scrollHandle({obj:window,fun:loadmoreRender});else if($(window).unbind("scroll",defaultScrollHandler),0<a.response.numFound)$(".load").addClass("hd"),$(".nomore").removeClass("hd");else{$(".IsEmpty").removeClass("hd");$(".load").addClass("hd");
return}a=dataHandling(a.response,a.highlighting);a=Handlebars.compile($("#tmplArticles").html())(a);$(".curResult").append(a)})}
function loadmoreRender(){PageData.start=PageData.pagenum*PageData.pagesize;PageData.pagenum+=1;var a={start:PageData.start,table:PageData.table,rows:PageData.pagesize,sort:PageData.sort};$(".loading").removeClass("hd");prepage!=PageData.pagenum&&(prepage=PageData.pagenum,client.search(PageData.searchword,a,function(a){$(".loading").addClass("hd");0>=a.response.docs.length?($(window).unbind("scroll",defaultScrollHandler),$(".load").addClass("hd"),$(".nomore").removeClass("hd"),$(".curResult li")):
(a=dataHandling(a.response,a.highlighting),a=Handlebars.compile($("#tmplArticles").html())(a),$(".curResult").append(a))}))};
