$(function(){new function(){var a=this,e=function(a,b){return~~(Math.random()*(b-a+1)+a)};window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};a.init=function(){a.canvas=document.createElement("canvas");a.canvas.width=a.cw=$("#topNewyear").width();a.canvas.height=a.ch=$("#topNewyear").height();a.particles=[];a.partCount=150;a.fireworks=
[];a.mx=a.cw/2;a.my=a.ch/2;a.currentHue=30;a.partSpeed=5;a.partSpeedVariance=10;a.partWind=50;a.partFriction=5;a.partGravity=1;a.hueMin=0;a.hueMax=360;a.fworkSpeed=4;a.fworkAccel=10;a.hueVariance=30;a.flickerDensity=25;a.showShockwave=!0;a.showTarget=!1;a.clearAlpha=25;$(document.body).append(a.canvas);a.ctx=a.canvas.getContext("2d");a.ctx.lineCap="round";a.ctx.lineJoin="round";a.lineWidth=1;a.bindEvents();a.canvasLoop();a.canvas.onselectstart=function(){return!1}};a.createParticles=function(c,b,
d){for(var f=a.partCount;f--;){var g={x:c,y:b,coordLast:[{x:c,y:b},{x:c,y:b},{x:c,y:b}],angle:e(0,360),speed:e(0>=a.partSpeed-a.partSpeedVariance?1:a.partSpeed-a.partSpeedVariance,a.partSpeed+a.partSpeedVariance),friction:1-a.partFriction/100,gravity:a.partGravity/2,hue:e(d-a.hueVariance,d+a.hueVariance),brightness:e(50,80),alpha:e(40,100)/100,decay:e(10,50)/1E3,wind:(e(0,a.partWind)-a.partWind/2)/25,lineWidth:a.lineWidth};a.particles.push(g)}};a.updateParticles=function(){for(var c=a.particles.length;c--;){var b=
a.particles[c],d=b.angle*Math.PI/180,e=Math.cos(d)*b.speed,d=Math.sin(d)*b.speed;b.speed*=b.friction;b.coordLast[2].x=b.coordLast[1].x;b.coordLast[2].y=b.coordLast[1].y;b.coordLast[1].x=b.coordLast[0].x;b.coordLast[1].y=b.coordLast[0].y;b.coordLast[0].x=b.x;b.coordLast[0].y=b.y;b.x+=e;b.y+=d;b.y+=b.gravity;b.angle+=b.wind;b.alpha-=b.decay;(0+a.cw<b.x-b.radius||(0>b.x-b.radius+2*b.radius||0+a.ch<b.y-b.radius||0>b.y-b.radius+2*b.radius)||0.05>b.alpha)&&a.particles.splice(c,1)}};a.drawParticles=function(){for(var c=
a.particles.length;c--;){var b=a.particles[c],d=e(1,3)-1;a.ctx.beginPath();a.ctx.moveTo(Math.round(b.coordLast[d].x),Math.round(b.coordLast[d].y));a.ctx.lineTo(Math.round(b.x),Math.round(b.y));a.ctx.closePath();a.ctx.strokeStyle="hsla("+b.hue+", 100%, "+b.brightness+"%, "+b.alpha+")";a.ctx.stroke();0<a.flickerDensity&&(d=50-a.flickerDensity,e(0,d)===d&&(a.ctx.beginPath(),a.ctx.arc(Math.round(b.x),Math.round(b.y),e(b.lineWidth,b.lineWidth+3)/2,0,2*Math.PI,!1),a.ctx.closePath(),d=e(50,100)/100,a.ctx.fillStyle=
"hsla("+b.hue+", 100%, "+b.brightness+"%, "+d+")",a.ctx.fill()))}};a.createFireworks=function(c,b,d,f){c={x:c,y:b,startX:c,startY:b,hitX:!1,hitY:!1,coordLast:[{x:c,y:b},{x:c,y:b},{x:c,y:b}],targetX:d,targetY:f,speed:a.fworkSpeed,angle:Math.atan2(f-b,d-c),shockwaveAngle:Math.atan2(f-b,d-c)+90*(Math.PI/180),acceleration:a.fworkAccel/100,hue:a.currentHue,brightness:e(50,80),alpha:e(50,100)/100,lineWidth:a.lineWidth};a.fireworks.push(c)};a.updateFireworks=function(){for(var c=a.fireworks.length;c--;){var b=
a.fireworks[c];a.ctx.lineWidth=b.lineWidth;vx=Math.cos(b.angle)*b.speed;vy=Math.sin(b.angle)*b.speed;b.speed*=1+b.acceleration;b.coordLast[2].x=b.coordLast[1].x;b.coordLast[2].y=b.coordLast[1].y;b.coordLast[1].x=b.coordLast[0].x;b.coordLast[1].y=b.coordLast[0].y;b.coordLast[0].x=b.x;b.coordLast[0].y=b.y;b.startX>=b.targetX?b.x+vx<=b.targetX?(b.x=b.targetX,b.hitX=!0):b.x+=vx:b.x+vx>=b.targetX?(b.x=b.targetX,b.hitX=!0):b.x+=vx;b.startY>=b.targetY?b.y+vy<=b.targetY?(b.y=b.targetY,b.hitY=!0):b.y+=vy:
b.y+vy>=b.targetY?(b.y=b.targetY,b.hitY=!0):b.y+=vy;b.hitX&&b.hitY&&(a.createParticles(b.targetX,b.targetY,b.hue),a.fireworks.splice(c,1))}};a.drawFireworks=function(){var c=a.fireworks.length;for(a.ctx.globalCompositeOperation="lighter";c--;){var b=a.fireworks[c];a.ctx.lineWidth=b.lineWidth;var d=e(1,3)-1;a.ctx.beginPath();a.ctx.moveTo(Math.round(b.coordLast[d].x),Math.round(b.coordLast[d].y));a.ctx.lineTo(Math.round(b.x),Math.round(b.y));a.ctx.closePath();a.ctx.strokeStyle="hsla("+b.hue+", 100%, "+
b.brightness+"%, "+b.alpha+")";a.ctx.stroke();a.showTarget&&(a.ctx.save(),a.ctx.beginPath(),a.ctx.arc(Math.round(b.targetX),Math.round(b.targetY),e(1,8),0,2*Math.PI,!1),a.ctx.closePath(),a.ctx.lineWidth=1,a.ctx.stroke(),a.ctx.restore());a.showShockwave&&(a.ctx.save(),a.ctx.translate(Math.round(b.x),Math.round(b.y)),a.ctx.rotate(b.shockwaveAngle),a.ctx.beginPath(),a.ctx.arc(0,0,1*(b.speed/5),0,Math.PI,!0),a.ctx.strokeStyle="hsla("+b.hue+", 100%, "+b.brightness+"%, "+e(25,60)/100+")",a.ctx.lineWidth=
b.lineWidth,a.ctx.stroke(),a.ctx.restore())}};a.bindEvents=function(){$(a.canvas).on("mousedown",function(c){a.mx=c.pageX-a.canvas.offsetLeft;a.my=c.pageY-a.canvas.offsetTop;a.currentHue=e(a.hueMin,a.hueMax);a.createFireworks(a.cw/2,a.ch,a.mx,a.my);$(a.canvas).on("mousemove.fireworks",function(b){a.mx=b.pageX-a.canvas.offsetLeft;a.my=b.pageY-a.canvas.offsetTop;a.currentHue=e(a.hueMin,a.hueMax);a.createFireworks(a.cw/2,a.ch,a.mx,a.my)})});$(a.canvas).on("mouseup",function(){$(a.canvas).off("mousemove.fireworks")})};
a.clear=function(){a.particles=[];a.fireworks=[];a.ctx.clearRect(0,0,a.cw,a.ch)};a.canvasLoop=function(){requestAnimFrame(a.canvasLoop,a.canvas);a.ctx.globalCompositeOperation="destination-out";a.ctx.fillStyle="rgba(0,0,0,"+a.clearAlpha/100+")";a.ctx.fillRect(0,0,a.cw,a.ch);a.updateFireworks();a.updateParticles();a.drawFireworks();a.drawParticles()};a.init()}});
