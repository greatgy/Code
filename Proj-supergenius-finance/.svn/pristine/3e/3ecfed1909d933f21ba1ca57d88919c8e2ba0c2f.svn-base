package com.supergenius.web.finance.api;

import javax.servlet.http.HttpServletRequest;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.genius.core.base.utils.JsonUtil;
import com.genius.server.base.controller.BaseController;
import com.supergenius.server.finance.helper.BaseCollectDetailHP;
import com.supergenius.server.user.helper.BaseUserHP;
import com.supergenius.web.finance.helper.FinanceHP;
import com.supergenius.xo.finance.entity.Finance;
import com.supergenius.xo.finance.enums.ECollectType;
import com.supergenius.xo.user.entity.User;

/** 
* app文章详情页
* @author chenminchang
* @date 2017年1月5日 下午12:23:02 
*/
@Controller
public class ArticleInterfacer extends BaseController {
	
	private static final String APPDEATIL = "appdetail";//自定义策略用于文章详情页json

	/**
	 * app加载文章详情页的文章内容相关
	 * @param request
	 * @param oid
	 * @return
	 * @author chenminchang
	 * @create 2017年1月5日下午4:42:50
	 */
	@RequestMapping( value = {"/api/article/{oid:\\d+}"}, method = RequestMethod.GET)
	@ResponseBody
	public String article_detail(HttpServletRequest request, @PathVariable int oid) {
		Finance finance = FinanceHP.getSerialize(oid);
		if (finance != null) {
			User user = BaseUserHP.getCurrUser(request);
			if(user != null) {
				//判断是否收藏
				if (BaseCollectDetailHP.isCollect(user.getUid(), ECollectType.article, finance.getUid()))
					finance.setIscollect(true);
			} else {
				finance.setIscollect(false);
			}
			return JsonUtil.toJson(finance, APPDEATIL);
		}
		return null;
	}
}
