package com.supergenius.test.constants;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.codec.digest.DigestUtils;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import com.genius.core.base.annotation.Json;
import com.genius.core.base.utils.JsonUtil;
import com.genius.core.base.utils.StrUtil;
import com.genius.model.base.entity.Pager;
import com.genius.model.base.enums.EStatus;
import com.supergenius.global.conf.WebConf;
import com.supergenius.server.common.constants.ViewKeyDict;
import com.supergenius.server.common.utils.ValidUtil;
import com.supergenius.web.finance.helper.FinanceHP;
import com.supergenius.xo.finance.entity.Finance;
import com.supergenius.xo.finance.enums.EFinance;
import com.supergenius.xo.finance.service.ContributeSO;
import com.supergenius.xo.finance.service.FinanceSO;
import com.supergenius.xo.user.entity.User;
import com.supergenius.xo.user.service.UserSO;

/**
 * @author Architect.bian
 * 
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = { "classpath*:**/applicationContext**.xml" })
public class TestConst {

	@Autowired
	private FinanceSO so;
	@Autowired
	private UserSO userSO;
	
	public static final String name = "zhangsan";
	
	public static final String _123456 = "123456";

	public static final String pwd_123456 = DigestUtils.md5Hex(_123456);

	public static final String userId = "greathill";

	public static final String uid = "uid00000000000000000000000000000";

	public static final String uid1 = "uid11111111111111111111111111111";

	public static final String uid2 = "uid22222222222222222222222222222";

	public static final int oid = 1;
	
	public static final String adminid = "test";
	
	@Test
	public void testLoadMoreByTypeInterface(){
				
		Map<String, Object> result = new HashMap<String, Object>();
		Pager pager = Pager.getNewInstance(1, WebConf.FinancePageSize);
		List<Finance> index = FinanceHP.getLatestList(EFinance.getByName("industries"), 1, WebConf.FinancePageSize);	
		result.put(ViewKeyDict.tops, index);		
		int total = so.getCount(EFinance.getByName("industries"));
		List<Finance> finances = so.getList(EFinance.getByName("industries"), pager);			
		result.put(ViewKeyDict.total, total);
		result.put(ViewKeyDict.list, finances);	
		System.out.println(JsonUtil.toJson(result, Json.appStrategy));
		
	}
	
	@Test
	public void testLogin(){
		Map<String, Object> model = new HashMap<String, Object>();
		String name = "123456789@qq.com";
		String password = "mima.123";
		
		User user = null;
		boolean flag = false;  //判断是否成功登录的状态位
		EStatus status = null; //用户状态
		if (ValidUtil.isEmail(name)) {//通过用户名获取user
			user = userSO.getByEmail(name);
		} else if (StrUtil.isNotEmpty(name)) {
			user = userSO.getByUsersn(name);
		}
		if (user != null && user.checkPwd(password)) {
			if (user.getIsInit()||user.getIsStart()||user.getIsEnd()) {// 未激活邮箱的会员,未完善，未身份验证   0
				status = EStatus.disable;    
			} else if (user.getIsDeleted()) { //删除状态的用户     2
				status = EStatus.deleted;
			} else if (user.getIsDisable()) { //冻结状态的用户     12
				status = EStatus.wait;				
			}else if (user.getIsEnable()) { //正常登陆	 1 
				status = EStatus.enable;
				flag = true;							
			}					
		}else { 
			status = EStatus.end;	//账号密码错误   13 
		}
		if(flag){ //判断是否是正常登陆
			model.put("user", user); //成功返回用户，失败返回空				
		}else{
			model.put("user", null);
		}
		model.put("status", EStatus.deleted);	
		System.out.println(JsonUtil.toJson(model, Json.appStrategy));
	}

}
