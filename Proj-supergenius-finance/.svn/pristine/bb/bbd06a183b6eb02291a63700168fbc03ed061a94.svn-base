package com.supergenius.web.finance.controller;

import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.genius.server.base.controller.BaseController;
import com.supergenius.global.conf.WebConf;
import com.supergenius.server.common.constants.ViewKeyDict;
import com.supergenius.web.finance.helper.DebateHP;
import com.supergenius.web.finance.helper.FinanceHP;
import com.supergenius.web.finance.helper.IndexHP;
import com.supergenius.web.finance.helper.TopicHP;
import com.supergenius.xo.common.enums.EChannel;
import com.supergenius.xo.common.enums.ECommentType;
import com.supergenius.xo.finance.entity.Debate;
import com.supergenius.xo.finance.entity.Finance;
import com.supergenius.xo.finance.entity.Topic;
import com.supergenius.xo.finance.enums.ECountType;

/**
 * 网站首页控制器
 *
 * @author ShangJianguo
 */
@Controller
public class IndexController extends BaseController {
	
	/**
	 * 跳转到首页并展示数据
	 * 
	 * @param model
	 * @param request
	 * @return
	 * @author: ShangJianguo 
	 * 2014-6-17 下午3:56:26
	 */
	@RequestMapping(value = { "/", "/index" }, method = RequestMethod.GET)
	public String index(Map<String, Object> model, HttpServletRequest request) {
		// 获取置顶的文章，如果置顶的文章不够再取全站最新的文章
		List<Finance> indexTopList = FinanceHP.getTopList();
		if (indexTopList.size() < WebConf.IndexFinanceTopSize) {
			List<Finance> allLatestList = FinanceHP.getLatestList(null, 1, WebConf.FinancePageSize);
			if (allLatestList.size() > WebConf.IndexFinanceTopSize) {
				allLatestList = allLatestList.subList(0, WebConf.IndexFinanceTopSize - indexTopList.size());
			}
			indexTopList.addAll(allLatestList);
		}
		// 当前期论战
		Debate debate = DebateHP.getCurDebate();
		Topic hotTopic = TopicHP.getTopicByCommentNumer();
		List<Finance> recmmendFinanceList = FinanceHP.getRecommendFinance();
		// 各个分类的最新文章
		Map<String, Object> map = IndexHP.getLatestArticle();
		// 文章排行榜
		List<Finance> rankList = FinanceHP.getRankList(ECountType.click, null);
		// 话题排行版
		List<Topic> topiclist = TopicHP.getListByTopicRankFromComments(EChannel.topic, ECommentType.comment);
		model.put(ViewKeyDict.list, indexTopList);
		model.put(ViewKeyDict.debate, debate);
		model.put(ViewKeyDict.topic, hotTopic);
		model.put(ViewKeyDict.map, map);
		model.put(ViewKeyDict.list2, rankList);
		model.put(ViewKeyDict.recommendlist, recmmendFinanceList);
		model.put(ViewKeyDict.topiclist, topiclist);
		return "index";
	}
}
