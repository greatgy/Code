package com.supergenius.web.finance.controller;

import java.util.Map;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.genius.server.base.controller.BaseController;
import com.supergenius.server.user.helper.BaseUserHP;
import com.supergenius.web.finance.helper.CollectDetailHP;
import com.supergenius.web.finance.helper.InboxHP;
import com.supergenius.web.finance.helper.MsgHP;
import com.supergenius.xo.finance.enums.ECollectType;
import com.supergenius.xo.finance.enums.EFinance;
import com.supergenius.xo.finance.service.CollectDetailSO;
import com.supergenius.xo.user.entity.User;

/**
 * 收藏明细控制器
 * @author YuYingJie
 */
@Controller
public class CollectDetailController extends BaseController {

	@Autowired
	CollectDetailSO so;

	/**
	 * 收藏
	 * @param model
	 * @param type
	 * @param finance
	 * @param id
	 * @param request
	 * @return
	 * @author YuYingJie
	 */
	@RequestMapping(value = "/my/ajax/collect/{type:[a-z]+}_{finance:[a-z]+}_{id:\\w{32}}", method = RequestMethod.GET)
	public @ResponseBody boolean addCollect(Map<String, Object> model, @PathVariable String type, @PathVariable String finance, @PathVariable String id, HttpServletRequest request) {
		User user = BaseUserHP.getCurrUser(request);
		ECollectType collectType = ECollectType.getByName(type);
		if (CollectDetailHP.isCollect(user.getUid(), collectType, id)) {
			CollectDetailHP.cancleCollect(user, collectType, id);
			return false;
		} else {
			EFinance financeType = null;
			if (ECollectType.article.equals(collectType)) {
				financeType = EFinance.getByName(finance);
			}
			if (CollectDetailHP.add(user, collectType, financeType, id)) {
				InboxHP.sendInboxByMsg(MsgHP.collectMsg(user, collectType, financeType, id));
				return true;
			}
			return false;
		}
	}

}
