(function(){$.ellipsisText=function(a,b){return a.length>b?a.substring(0,b)+"...":a};Components={BroadcastPanel:function(a,b){this.element=a;this.options=b?b:{};this.options.interval=this.options.interval?this.options.interval:5;this.options.hotsCount=this.options.hotsCount?this.options.hotsCount:4;this.render()}};Components.BroadcastPanel.prototype.render=function(){this.element.empty();var a=this;this.element.html((new EJS({text:$("#broadcast-template").html()})).render(a.options));this.element.find("[index]").mouseenter(function(b){a.pause();
a.select(parseInt($(b.currentTarget).attr("index")))});this.element.find("[index]").mouseleave(function(){a.goahead()});this.element.find(".broadcast-next").click(function(){a.pause();a.next();a.goahead()});this.element.find(".broadcast-previous").click(function(){a.pause();a.previous();a.goahead()});this.select(0);this.play()};Components.BroadcastPanel.prototype.setHots=function(a){this.options.hots=a;this.render()};Components.BroadcastPanel.prototype.play=function(){var a=this,b=function(){a.paused||
a.next();setTimeout(b,1E3*a.options.interval)};setTimeout(b,1E3*a.options.interval)};Components.BroadcastPanel.prototype.pause=function(){this.paused=!0};Components.BroadcastPanel.prototype.goahead=function(){this.paused=!1};Components.BroadcastPanel.prototype.next=function(){this.select((this.currentIndex+1)%this.options.hotsCount)};Components.BroadcastPanel.prototype.previous=function(){this.select((0===this.currentIndex?this.options.hotsCount-1:this.currentIndex-1)%this.options.hotsCount)};Components.BroadcastPanel.prototype.select=
function(a){this.element.find('[index="'+this.currentIndex+'"] .broadcast-cover').css({top:"0px"});this.currentIndex=a;var b=this.options.hots[a]?this.options.hots[a]:{link:"",img:"",title:"\u65e0"};this.element.find(".broadcast-center").attr("href",b.link);this.element.find(".broadcast-center > img").attr("src",b.img);var c=$.ellipsisText(b.title,23);this.element.find(".broadcast-link > a").attr("title",b.title).attr("href",b.link).html(c);this.element.find('[index="'+a+'"] .broadcast-cover').css({top:"100%"})};
Components.BalancePanel=function(a,b){this.element=a;this.options=b;this.element.html((new EJS({text:$("#balance-template").html()})).render(b));this.lean();this.initEvents()};Components.BalancePanel.prototype.initEvents=function(){$(".debate_vote").click(function(){if(-1!=hasvote)alertvote(hasvote);else{isred="red"==$(this).data("support")?!0:!1;var a=this;$.get(g.base+"/debate/vote/"+debateuid,{isred:isred},function(b){!0==b.success?(b=$(a).html(),$(a).html(parseInt(b)+1),new Components.BalancePanel($(".tp_midd"),
{left:parseInt($(".left-number").html()),right:parseInt($(".right-number").html())}),handleHasvote(isred)):!0==b.voted?(alertvote(b.isred),alertisred(isred)):alert("\u672a\u77e5\u9519\u8bef\uff0c\u6295\u7968\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5\uff01")})}})};Components.BalancePanel.prototype.setValues=function(a,b){this.options.left=a;this.options.right=b;this.element.find(".left-number").html(a);this.element.find(".right-number").html(b);this.lean()};Components.BalancePanel.prototype.lean=
function(){var a=this.element.find(".balance-lever").width()/2,b=this.element.find(".balance-pivot").height(),b=Math.atan(b/a),c=0,d=0,e=0;this.options.left>this.options.right?(c=(this.options.left-this.options.right)/this.options.left,c*=-b,d=(a-this.element.find(".left-data").width())*Math.tan(c),e=a*Math.tan(c)):this.options.left<this.options.right&&(c=(this.options.right-this.options.left)/this.options.right,c*=b,d=a*Math.tan(c),e=(a-this.element.find(".left-data").width())*Math.tan(c));$.support.leadingWhitespace&&
(this.element.find(".balance-lever").css("transform","rotate("+180*(c/Math.PI)+"deg)"),this.element.find(".left-data").css("top",65-d+"px"),this.element.find(".right-data").css("top",65+e+"px"));this.element.find(".left-lever").css("width",79*(this.options.left/(this.options.left+this.options.right))+10+"%");a=79*(this.options.right/(this.options.left+this.options.right))+10;this.element.find(".right-lever").css("width",a+"%").css("margin-left",100-a+"%")}})();
