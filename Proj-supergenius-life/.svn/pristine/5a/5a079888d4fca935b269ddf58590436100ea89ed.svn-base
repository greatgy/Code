$(function(b){loadmore();b(document).on("click","a[id^='btnprize']",function(){unRegisterPraise();b(this).prize()});b(document).on("click","a[id^='deletecomment']",function(){var d=b(this).parent().parent();if(confirm("\u786e\u5b9a\u5220\u9664\u5417\uff1f"))deleteComment(d);else return!1});b.fn.scrollHandle({obj:window,fun:loadmore});prizeBindEvent();collectBindEvet()});
function submitCommentHandler(b){$(b).blur();beforeSubmitHandler(b);""==params.content.trim()?alert("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"):($(".problemmask").hide(),$(".problemmaskContent").hide(),$.post(base+"/ajax/answer/{0}".format(params.fromuid),params,function(d){afterSubmitHandler(d,b)}))}var params={content:"",fromuid:"",cid:"",isnick:""};
function beforeSubmitHandler(b){params={};params.fromuid=fromuid;params.cid=cid;var d=$(b).siblings("#content");params.content=d.val();d=$(b).parent().parent();if(!d.hasClass("contentLeft")||!d.hasClass("commentitemRt"))d=$(b).parent().siblings(".commentitemRt");b=d.data("uid");var a=d.data("topuid");"undefined"!=typeof a&&(params.topuid=a);"undefined"!=typeof b&&(params.touid=b,params.touseruid=d.data("touseruid"),params.tousername=d.data("tousername"));$("#isnick").attr("checked")&&(params.isnick=
"1")}
function afterSubmitHandler(b,d){if(b.success){console.log(b.bean);console.log(b.bean.ismajor);if(1!=b.bean.ismajor)$(d).siblings("#content").val(""),$(".nothing").addClass("hd"),addComment(b.bean,d),$("div").remove("#replyBoxed");else{console.log(123);var a=b.bean,c;c='<li class="ment"><div class="qsUserimg">';c+="<img ";""!=a.fromVisitorAvatar&&null!=a.fromVisitorAvatar?c+=' src="'+userimg+a.fromVisitorAvatar+'"/>':(c=""!=me.useravatar.trim()?c+(' src="'+me.useravatar+'"'):c+('src="'+me.defaultImg+'"'),
c=me.isuser?c+('class="userborder" /><img src="'+baseimg+'/imgs/default/prince.png" class="problemprinceimg" alt="" />'):c+"/>");c+="</div>";"undefined"==typeof params.topuid&&(params.topuid=params.touid);c+='<div class="commentitemRt" data-uid="'+a.uid+'" data-topuid="'+params.topuid+'" data-touseruid="'+a.fromuseruid+'"  data-tousername="'+a.fromusername+'" data-useruid="'+me.uid+'" >';c+='<div class="qsUsername">';c=""==a.fromVisitorName||null==a.fromVisitorName?c+("&nbsp;"+a.fromusername+"&nbsp;"):
c+("&nbsp;"+a.fromVisitorName+"&nbsp;");c+='<a id="deletecomment_'+a.uid+'" class="delete"><img src="'+baseimg+'/imgs/default/crush.png"/></a>';c+="</div>";c+='<div class="qsword">';c+=a.content+"</div>";c+='<div class="wordBottom">';c+='<span class="qstime">&nbsp;\u521a\u521a</span>';c+='<div class="qsCommentOperate">';c+='<a class="zan" id="btnprizeproblem_answerpraise_';c=""!=me||null!=me||"undefined"!=typeof me?c+me.oid:c+"0";c+="_"+cid+"_"+a.uid+'" data-counter=".prizecounter">';c+='<img src="'+
baseimg+'/imgs/default/zan.png" data-isprize="false"><span class="zancountjs">0</span></a>';c+='<a data-reply="replyopen" href="javascript:;" class="reply" onclick="reply(this)">\u56de\u590d';c+="</a>";c+="</div>";c+="</div>";c+="</div>";c+="</li>"}$("#secondmajor").prepend(c);initBindEvent();initPage()}else alert("\u8bc4\u8bba\u5931\u8d25"),$(".problemmask").show(),$(".problemmaskContent").show()}
function addComment(b,d){$(d).parent().parent().parent();var a="";-1!=$(d).parent().attr("class").indexOf("problemmaskContent")?(a+='<li class="commentitem"><div class="qsUserimg">',a+="<img ",""!=b.fromVisitorAvatar&&null!=b.fromVisitorAvatar?a+=' src="'+userimg+b.fromVisitorAvatar+'"/>':(a=""!=me.useravatar.trim()?a+(' src="'+me.useravatar+'"'):a+('src="'+me.defaultImg+'"'),a=me.isuser?a+('class="userborder" /><img src="'+baseimg+'/imgs/default/prince.png" class="problemprinceimg" alt="" />'):a+
"/>"),a+="</div>",a+='<div class="commentitemRt replay_comment"  data-uid="'+b.uid+'" data-touseruid="'+b.fromuseruid+'"  data-tousername="'+b.fromusername+'" data-useruid="'+me.uid+'">',a+='<div class="qsUsername">',a=""==b.fromVisitorName||null==b.fromVisitorName?a+("&nbsp;"+b.fromusername+"&nbsp;"):a+("&nbsp;"+b.fromVisitorName+"&nbsp;"),a+='<a id="deletecomment_'+b.uid+'" class="delete"><img src="'+baseimg+'/imgs/default/crush.png"/></a>',a+="</div>",a+='<div class="qsword">'+b.content+"</div>",
a+='<div class="wordBottom">',a+='<span class="qstime">&nbsp;\u521a\u521a</span>',a+='<div class="qsCommentOperate">',a+='<a class="zan" id="btnprizeproblem_answerpraise_',a=""!=me||null!=me||"undefined"!=typeof me?a+me.oid:a+"0",a+="_"+cid+"_"+b.uid+'" data-counter=".prizecounter">',a+='<img src="'+baseimg+'/imgs/default/zan.png" data-isprize="false"><span class="zancountjs">0</span></a>',a+='<a data-reply="replyopen" href="javascript:;" class="reply" onclick="reply(this)"><img src="'+baseimg+'/imgs/default/discuss.png"><span id="commentcount">0</span></a>',
a+="</a>",a+='<a data-reply="true" class="leftcomments hd" onclick="showcomment(this);">\u5c55\u5f00',a+="</a>",a+="</div>",a+="</div>",a+="</div>",a+='<div id="second" class="secondComment hd" >',a+="</div>",a+='<div class="loadmorefinance hd">',a+='<a href="javascript:void(0)" id="loadmore" onclick="load(this)">\u52a0\u8f7d\u66f4\u591a</a>',a+="</div>",a+="</li>",$("#displayComment").prepend(a)):(a+='<li class="ment">',a+='<div class="qsUserimg">',a+="<img ",""!=b.fromVisitorAvatar&&null!=b.fromVisitorAvatar?
a+=' src="'+userimg+b.fromVisitorAvatar+'"/>':(a=""!=me.useravatar.trim()?a+(' src="'+me.useravatar+'"'):a+('src="'+me.defaultImg+'"'),a=me.isuser?a+('class="userborder" /><img src="'+baseimg+'/imgs/default/prince.png" class="problemprinceimg" alt="" />'):a+"/>"),a+="</div>","undefined"==typeof params.topuid&&(params.topuid=params.touid),a+='<div class="commentitemRt" data-uid="'+b.uid+'" data-topuid="'+params.topuid+'" data-touseruid="'+b.fromuseruid+'"  data-tousername="'+b.fromusername+'" data-useruid="'+
me.uid+'" >',a+='<div class="qsUsername">',a=""==b.fromVisitorName||null==b.fromVisitorName?a+("&nbsp;"+b.fromusername+"&nbsp;"):a+("&nbsp;"+b.fromVisitorName+"&nbsp;"),a+='<a id="deletecomment_'+b.uid+'" class="delete"><img src="'+baseimg+'/imgs/default/crush.png"/></a>',a+="</div>",a+='<div class="qsword">',a+="<span>@"+PrivateString(b.tousername)+":</span>"+b.content+"</div>",a+='<div class="wordBottom">',a+='<span class="qstime">&nbsp;\u521a\u521a</span>',a+='<div class="qsCommentOperate">',a+=
'<a class="zan" id="btnprizeproblem_answerpraise_',a=""!=me||null!=me||"undefined"!=typeof me?a+me.oid:a+"0",a+="_"+cid+"_"+b.uid+'" data-counter=".prizecounter">',a+='<img src="'+baseimg+'/imgs/default/zan.png" data-isprize="false"><span class="zancountjs">0</span></a>',a+='<a data-reply="replyopen" href="javascript:;" class="reply" onclick="reply(this)">\u56de\u590d',a+="</a>",a+='<a class="leftcomments hd" onclick="showcomment(this);">&nbsp;|&nbsp;<span id="commentcount">0</span>\u6761\u56de\u590d<img src="'+
baseimg+'/imgs/default/arrawDown.png" alt="\u5c55\u5f00" />',a+="</a>",a+="</div>",a+="</div>",a+="</div>",a+="</li>",-1!=$(d).parent().siblings(".commentitemRt").attr("class").indexOf("replay_comment")?(a=$(d).parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".leftcomments"),showcomment(a),$(a).parent().parent().parent().siblings("#second").hasClass("hd")&&showcomment(a),$(d).parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".leftcomments").hasClass("hd")&&
$(d).parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".leftcomments").removeClass("hd"),a=$(d).parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".reply").children("#commentcount").html(),$(d).parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".reply").children("#commentcount").html(parseInt(a)+1)):($(d).parent().parent().after(a),a=$(d).parent().parent().parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".reply").children("#commentcount").html(),
$(d).parent().parent().parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".reply").children("#commentcount").html(parseInt(a)+1)),$(d).parent().siblings("#second").css("display","block"),initBindEvent(),reply($(d).parent().siblings(".commentitemRt ").children().find(".reply")));a=$("#problemcommentcount").html();$("#problemcommentcount").html(parseInt(a)+1);initPage()}
function reply(b){getIdNumber();if("replyopen"==$(b).data("reply")){0!=$(".replyBox").length&&($(".replyBox").siblings(".wordBottom").children(".commentOperate").children(".reply").data("reply","replyopen"),$(".replyBox").remove());var d;d='<div class="replyBox" id="replyBoxed"><textarea class="comment_textarea1" id="content"/>';d+='<a class="qsface"><img src="'+baseimg+'/imgs/default/smile.png" alt=""></a>';d+='<button class="submitBtn" onclick="submitCommentHandler(this)">\u63d0\u4ea4</button>';
d+="</div>";$(b).parent().parent().parent().after(d);$(".replyBox").css("display","block");$(".comment_textarea1").focus();initBindEvent();$(b).data("reply","replyclose")}else $(b).data("reply","replyopen"),$(".replyBox").remove()}var num=1,diplayID="#displayComment";
function loadmore(){var b="",b=0==type?base+"/ajax/answer/"+cid+"_"+fromuid+"_{0}".format(num):base+"/ajax/lifeanswer/hotanswer";$.ajax({type:"GET",url:b,data:{fromuid:fromuid,cid:cid,pagenum:num},success:function(b){console.log(b);""==b.trim()?(1==num&&$(".nothing").removeClass("hd"),$(window).unbind("scroll",defaultScrollHandler)):(num+=1,$(".nothing").addClass("hd"),$(diplayID).append(b),initPage(),prizeBindEvent())}})}
function updatePrizeCount(b,d){var a=$(b).find(".zancountjs").html();d?$(b).find(".zancountjs").html(parseInt(a)+1):$(b).find(".zancountjs").html(parseInt(a)-1)}function unRegisterPraise(){$("a[id^='btnprize']").each(function(){$(this).off("click")})}function wantComment(){$("#content").focus()}var firstuid=0,pagenum;
function showcomment(b){"true"==$(b).data("reply")?($(b).parent().parent().parent().siblings("#second").addClass("hd"),$(b).parent().parent().parent().siblings("#second").css("display","none"),$(b).parent().parent().parent().siblings("#second").empty(),$(b).data("reply","false"),$(b).text("\u5c55\u5f00"),$(b).append(' <img src="'+baseimg+'/imgs/default/arrawDown.png" alt="\u5c55\u5f00" />')):($(b).data("reply","true"),$(b).parent().parent().parent().siblings("#second").removeClass("hd"),firstuid=
$(b).parent().parent().parent().data("uid"),pagenum=1,getcomment(b),$("#loadmore").bind("click",function(){getcomment(b)}),$(b).text("\u6536\u8d77"),$(b).append(' <img src="'+baseimg+'/imgs/default/arrawDownup.png" alt="\u6536\u8d77" />'))}function load(b){b=$(b).parent().siblings(".commentitemRt").children(".wordBottom").children(".qsCommentOperate").children(".leftcomments");getcomment(b)}
function getcomment(b){var d=base+"/ajax/secondanswer/"+firstuid+"_"+cid+"_{0}".format(pagenum);$.ajax({type:"GET",url:d,success:function(a){""==a.trim()?$(".loadmorefinance").addClass("hd"):(19<$(b).parent().parent().parent().siblings("#second").children(".ment").length&&$(".loadmorefinance").removeClass("hd"),$(b).parent().parent().parent().siblings("#second").append(a),$(b).parent().parent().parent().siblings("#second").css("display","block"),pagenum+=1,initPage(),prizeBindEvent())}})}
function deleteComment(b){var d=$(b).data("topuid"),a=$("#problemcommentcount").html(),c=$(b).children(".wordBottom").children(".qsCommentOperate").children(".reply").children("#commentcount").html(),f=$(b).data("uid"),h=$(b).data("touseruid"),j=$(b).data("useruid");$.ajax({type:"GET",url:base+"/ajax/answer/delete/"+f+"/"+h+"/lifeproblem/"+j,success:function(e){e&&(null!=d&&""!=d&&"undefined"!=d?(e=$(b).parent().parent().siblings(".replay_comment").children(".wordBottom").children(".qsCommentOperate").children(".reply").children("#commentcount").html(),
$(b).parent().parent().siblings(".replay_comment").children(".wordBottom").children(".qsCommentOperate").children(".reply").children("#commentcount").html(parseInt(e)-1),$("#problemcommentcount").html(parseInt(a)-1),0==parseInt(e)-1&&$(b).parent().parent().siblings(".replay_comment").children(".wordBottom").children(".qsCommentOperate").children(".leftcomments").addClass("hd")):$("#problemcommentcount").html(parseInt(a)-parseInt(c)-1),$(b).parent().addClass("hd"))}})}
function replaceContent(b){return b=b.replace(/\[em_([0-9]*)\]/g,'<img src="'+g.baseimg+'/imgs/face/qq/$1.gif" border="0" />')}var idNumber=0;function getIdNumber(){idNumber++;return"finance_"+idNumber.toString()}function initBindEvent(){$(".qsface").unbind("click");$(".qsface").qqFace({assign:"content",path:g.baseimg+"/imgs/face/qq/"})}function initPage(){$(".qsword").each(function(){var b=replaceContent($(this).html());$(this).html(b)})}
function initData(b){return $(b).parent().parent().parent().find("textarea").data("suffix")}
function PrivateString(b){var d=/([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)/;if(/^((\(\d{2,3}\))|(\d{3}\-))?(13|14|15|18)\d{9}$/.test(b))b=b.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2");else if(d.test(b)){var d=String(b).indexOf("@"),a=b.substr(0,d);b=6<a.length?8<a.length?b.substr(0,3)+"****"+b.substr(d-4):b.substr(0,3)+"****"+b.substr(d-2):b.substr(0,3)+"****"+b.substr(d-1)}return b};
