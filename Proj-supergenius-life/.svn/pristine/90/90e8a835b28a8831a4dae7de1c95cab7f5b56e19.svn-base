[#ftl]
[#import "/WEB-INF/FtlLib/Macro/Public.ftl" as p]
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>${title!'天才人生'}</title>
	<link rel="stylesheet" href="${basecss}/css/mobile/default/index.css">
		<script type="text/javascript" src="${basejs}/js/pages/scroll.js"></script>
	<link rel="stylesheet" href="${basecss}/css/mobile/pagination.css">
		<script type="text/javascript" src="${basejs}/js/pages/history.js"></script>
	<script type="text/javascript" src="${basejs}/js/mobile/jquery.pagination.js"></script>
	<style>
	
	
	</style>
</head>
<body>
	<div class="tabBox">
		<ul class="tabList">
			<li id="newarticle" onclick="newsArticles(this);" class="curTab col-sm-6 col-xs-6 curjudge" data-index="0">最新文章</li>
			<li id="hotarticle" onclick="hotsArticles(this);" class="col-sm-6 col-xs-6" data-index="1">热门文章</li>
		</ul>
		[#if bean??]${bean.content}[/#if]
		<div class="swiper-container swiper-container-h swiper-container-horizontal swiper-container-autoheight">
			<div id="lunzhuan" class="swiper-wrapper">
				<div class="swiper-slide ">
						<!-- 轮播 -->
						<div id="lunbo" class="lunboindex swiper-container swiper-container-horizontal">
							<ul id="banner_list" class="swiper-wrapper">
								[#if list??]
									[#assign bannercount = 0]
									[#list list as item]	
										[#if bannercount <4]
											<li data-index="${bannercount}" class="swiper-slide">
												<a href="${base}/article/${cid?c}/${(item.oid)?c}" class="banneritem" style="background: #000 url(${webimg}${item.imgbig}) no-repeat center center;background-size: 100% 100%;" title="${item.title}">
													<p class="titlebottom">
														${item.title}
													</p>
												</a>
											</li>
										[/#if]
										[#assign bannercount = bannercount + 1]
									[/#list]
								[/#if]
							</ul>
						</div>
					<ul class="tabBoxplace" style="margin-top:30px;">
					[#if list??]
						[#list list as article]
							<li>
								<a class="tabitemimg" href="${base}/article/${cid?c}/${(article.oid)?c}" title="${article.title}">
									<img src="${webimg}${article.imgmedium}" alt="${article.title}" title="${article.title}"/>
								</a>
								<div class="tabitemRt">
									<a href="${base}/article/${cid?c}/${(article.oid)?c}" class="articleTitle">
										[#if article.isoriginal == 1]
											<span class="original">[原创]</span>
										[/#if]
										[#if article.kind == 1]
											<span class="videotype">[视频]</span>
										[#elseif article.kind == 2]
											<span class="pictype">[图片]</span>
										[/#if]
										${article.title}
									</a>
									<p class="descripe">
										[#if article.summary==""]
											[@p.TrimSubstring content="${article.content}" mylength=80 /]
										[#else]
											[@p.TrimSubstring content="${article.summary}" mylength=80 /]
										[/#if]
									</p>
									<div class="timepiece">
										<span class="time">
											[@p.mytime datetime="${article.createtimeStr}"/]
										</span>
										<div class="operateBox">
											<a href="${base}/article/${cid?c}/${(article.oid)?c}" class="littleicon">
												<img src="${baseimg}/imgs/default/clickcount.png" />
												${article.clickcount}
											</a>
											<a href="${base}/article/${cid?c}/${(article.oid)?c}" class="littleicon">
												<img src="${baseimg}/imgs/default/heart.png" />
												${article.prizecount}
											</a>
										</div>
									</div>
								</div>
							</li>
						[/#list]
					[/#if]
					</ul>
				</div>
				<div class="swiper-slide">
					<ul class="hotArticles">
						 [#if hotArticleList??]
						[#list hotArticleList as article]
							<li>
								<a class="tabitemimg" href="${base}/article/${cid?c}/${(article.oid)?c}" title="${article.title}">
									<img src="${webimg}${article.imgmedium}" alt="${article.title}" title="${article.title}"/>
								</a>
								<div class="tabitemRt">
									<a href="${base}/article/${cid?c}/${(article.oid)?c}" class="articleTitle">
										[#if article.isoriginal == 1]
											<span class="original">[原创]</span>
										[/#if]
										[#if article.kind == 1]
											<span class="videotype">[视频]</span>
										[#elseif article.kind == 2]
											<span class="pictype">[图片]</span>
										[/#if]
										${article.title}
									</a>
									<p class="descripe">
										[#if article.summary==""]
											[@p.TrimSubstring content="${article.content}" mylength=80 /]
										[#else]
											[@p.TrimSubstring content="${article.summary}" mylength=80 /]
										[/#if]
									</p>
									<div class="timepiece">
										<span class="time">
											[@p.mytime datetime="${article.createtimeStr}"/]
										</span>
										<div class="operateBox">
											<a href="${base}/article/${cid?c}/${(article.oid)?c}" class="littleicon">
												<img src="${baseimg}/imgs/default/clickcount.png" />
												${article.clickcount}
											</a>
											<a href="${base}/article/${cid?c}/${(article.oid)?c}" class="littleicon">
												<img src="${baseimg}/imgs/default/heart.png" />
												${article.prizecount}
											</a>
										</div>
									</div>
								</div>
							</li>
						[/#list]
					[/#if]
					</ul>
				</div>
			</div>
		</div>
	</div>

	
	
	
	<script>
		$(function(){
			/*轮播*/
            /*轮播*/
            var swiper1 = new Swiper('#lunbo', {
                pagination: '.swiper-pagination',
                paginationClickable: true,
                spaceBetween: 30,
                centeredSlides: true,
                autoplay: 2500,
                autoplayDisableOnInteraction: false
            });
            var puzzSwiper = new Swiper('#lunzhuan', {
		    	slidesPerView: 1,
			    loop: false,
			    autoplayDisableOnInteraction : false,
				onSlideChangeStart: function(swiper){
			      $(".tabList").children("li").each(function(){ 
			      	if($(this).data("index") == swiper.activeIndex){
			      		$(this).addClass("curTab").siblings().removeClass("curTab");
			      	}
			      	scrollForSlide(swiper.activeIndex);
			      });
			    }
		    });
		    
			$(".tabList li").click(function(){
				$(this).addClass("curTab").siblings().removeClass("curTab");
			});
			
			 $("#newarticle").click(function(){
				puzzSwiper.slideTo(0, 500, false);
				scrollToNewArticle();
			});
			$("#hotarticle").click(function(){
				puzzSwiper.slideTo(1, 500, false);
				scrollToHotArticle();
			});

            var swiperh = new Swiper('.swiper-container-h', {
	                autoHeight:true,
	                slidesPerView: 1,
	                loop: false,
	            });
			});
		function scrollForSlide(index){
			if(index == 0){
				scrollToNewArticle();
				console.log(0)
			}
			if(index == 1){
				console.log(1)
				scrollToHotArticle();
			}
		}
		
		function scrollToNewArticle(){
				$(window).unbind("scroll", defaultScrollHandler);
				console.log("new")
				$.fn.scrollHandle({
					obj: window,
					fun: loadmore
				})
			};
		function scrollToHotArticle(){
			$(window).unbind("scroll", defaultScrollHandler);
				console.log("hot")
			$.fn.scrollHandle({
				obj: window,
				fun: loadhotarticle
			})
		};
		
		var prePage = 2;
		var pagenum = 3;
		// 加载更多文章
		function loadmore() {
			var	url = "${base}/ajax/otherpage/catalogue/${cid?c}";
			if(prePage != pagenum) {
			    prePage = pagenum;
				$.get(url, {pagenum:pagenum}, function(data){
					if(data.trim() == ""){// 没有更多内容
						$(window).unbind("scroll", defaultScrollHandler);
						return false;
					}
					$(".tabBoxplace").append(data);
					history_num = pagenum;
					pagenum+=1;
				});
			}
		}
		//获得最热话题
		function hotsArticles(obj){
			ishot = true;
			pagenum = 1;
			$(obj).addClass("curjudge").siblings().removeClass("curjudge");
			var url = "${base}/m/ajax/article/hottravel";
			var json = {};
			json.cid='${cid?c}';
			json.pagenum=pagenum;
			$.get(url, json,function(data){
				if(data != ''){
					pagenum +=1;
					$(".tabBox").html(data);
				}
			});
		}
		
		//获得最新话题
		function newsArticles(obj){
			ishot = false;
			pagenum = 1;
			prePage=pagenum;
			$(obj).addClass("curjudge").siblings().removeClass("curjudge");
			var url = "${base}/m/ajax/otherpage/catalogue/${cid?c}";
			$.get(url, {pagenum:pagenum},function(data){
				if(data != ''){
					pagenum +=1;
					$(".tabBoxplace").html(data);
				}
			});
		}
		
	</script>
</body>
</html>