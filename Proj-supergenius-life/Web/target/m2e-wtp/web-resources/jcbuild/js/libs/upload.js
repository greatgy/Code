$.fn.bindUpload=function(l){var r=l.url||"",p=l.type||"",j=l.num||"",s=l.callbackPath||"#callbackPath",q=l.size||5,e=this,n=this.find("input.add"),f=0,g=null,h=[];1==j?n.removeAttr("multiple"):n.attr("multiple");this.openWindow=function(c){for(var d=0,a=0;a<c.length;a++)j&&a<j||!j?(d+=c[a].size,h.push({name:c[a].name,state:0})):h.push({name:c[a].name,state:1});a='<div id="zwb_upload_status" ';"careercomplainarea"==channel&&(a+='style="left:'+width+';height:0"');a+='> <div class="box" ';"careertease"==
channel&&(a+='style="top:20%"');a+='>        <div class="title">            \u5171'+c.length+"\u4e2a\u6587\u4ef6&nbsp;"+(0==(d/1048576).toFixed(3)?d/1048576:(d/1048576).toFixed(3))+'mb        </div>        <div class="list"><ul class="listBox"></ul></div>        <div class="foot">            <span class="ok">\u4e00\u952e\u4e0a\u4f20</span>            <span class="off">\u5173\u95ed</span>        </div></div>    </div>';e.append(a);e.find(".off").bind("click",function(){n.val("");e.find("#zwb_upload_status").fadeOut(100,
function(){$(this).remove()});h=[];c=null});e.getImgSrc(c)};this.getImgSrc=function(c){var d=new FileReader,a=c[f].size,m=c[f].name,b=m.lastIndexOf("."),b=m.substring(b+1,m.length),k="";""!=p&&-1==p.indexOf(b)&&(k="\u6587\u4ef6\u683c\u5f0f\u975e\u6cd5",h[f].state=1);""!=q&&a/20971520>q&&(k="\u6587\u4ef6\u8fc7\u5927",h[f].state=1);if("png"==b||"jpg"==b||"jpeg"==b||"gif"==b||"svg"==b)d.readAsDataURL(c[f]),d.onload=function(){var b=d.result;if(f<j||""==j)e.find("#zwb_upload_status ul.listBox").append('<li><img  src="'+
b+'"/><a><p class="name">'+m+'</p><p class="size">\u5927\u5c0f:&nbsp;'+(0==(a/1048576).toFixed(3)?a/1048576:(a/1048576).toFixed(3))+'b</p><p>\u72b6\u6001:&nbsp;<b class="state">\u672a\u4e0a\u4f20</b></p></a><span class="success"></span><span class="delete"></span><div class="err"'+(k?'style="width:100%;"':"")+">"+k+'</div><div class="progressBox"><div class="progress"></div></div></li>');f++;if(f==c.length)f=0,e.find(e.find("#zwb_upload_status").fadeIn(100)),g=e.find("#zwb_upload_status ul.listBox li"),
e.find(".ok").bind("click",function(){for(var b=c.length,a=0;a<c.length;a++)0==h[a].state&&e.upload(b,a,c[a])}),e.find(".delete").bind("click",function(){var b=$(this).parent().index();h[b].state=1;$(this).parent().hide(100)});else return e.getImgSrc(c)};else{imgPath="zip"==b||"rar"==b||"jar"==b||"7z"==b||"cab"==b||"iso"==b?"img/zip.png":"text"==b?"img/text.png":"doc"==b?"img/word.png":"html"==b||"htm"==b||"url"==b?"img/html.png":"xls"==b?"img/excal.png":"exe"==b?"img/exe.png":"css"==b||"less"==b||
"sass"==b?"img/css.jpg":"js"==b?"img/js.jpg":"php"==b?"img/php.png":"sql"==b?"img/sql.png":"ttf"==b||"otf"==b||"ttc"==b||"woff"==b||"woff2"==b?"img/font.png":"img/unknown.png";if(f<j||""==j)e.find("#zwb_upload_status ul.listBox").append('<li><img  src="'+imgPath+'"/><a><p class="name">'+m+'</p><p class="size">\u5927\u5c0f:&nbsp;'+(0==(a/1048576).toFixed(3)?a/1048576:(a/1048576).toFixed(3))+'b</p><p>\u72b6\u6001:&nbsp;<b class="state">\u672a\u4e0a\u4f20</b></p></a><span class="success"></span><span class="delete"></span><div class="err"'+
(k?'style="width:100%;"':"")+">"+k+'</div><div class="progressBox"><div class="progress"></div></div></li>');f++;if(f==c.length)f=0,e.find(e.find("#zwb_upload_status").fadeIn(100)),g=e.find("#zwb_upload_status ul.listBox li"),e.find(".ok").bind("click",function(){for(var b=c.length,a=0;a<c.length;a++)0==h[a].state&&e.upload(b,a,c[a])}),e.find(".delete").bind("click",function(){var b=$(this).parent().index();h[b].state=1;$(this).parent().hide(100)});else return e.getImgSrc(c)}};this.upload=function(c,
d,a){c=new FormData;c.append("file",a);$.ajax({url:r,type:"post",data:c,dataType:"json",cache:!1,contentType:!1,processData:!1,beforeSend:function(){g.eq(d).find(".progressBox").show()},xhr:function(){myXhr=$.ajaxSettings.xhr();myXhr.upload&&myXhr.upload.addEventListener("progress",function(a){a=(100*(a.loaded/a.total)).toFixed(2);g.eq(d).find(".progress").width(a+"%")},!1);return myXhr},success:function(a){if(1==a.state){h[d].state=1;g.eq(d).find(".state").html("\u4e0a\u4f20\u6210\u529f");g.eq(d).find(".success").addClass("success2");
g.eq(d).find(".delete").remove();var b=$(s),c=b.val();b.val(c+a.path+"@");a=a.path[2];html='<a class="imgb" title="" href="'+webimg+a+'" target="_blank"><img alt="" src="'+webimg+a+'" /></a>';$("#preBox").append(html)}else g.eq(d).find(".state").html(a.errmsg),g.eq(d).find(".err").width("100%").html(a.errmsg);g.eq(d).find(".progressBox").hide()},error:function(){g.eq(d).find(".progressBox").hide();g.eq(d).find(".state").html("\u8bf7\u6c42\u5931\u8d25");g.eq(d).find(".err").width("100%").html("\u8bf7\u6c42\u5931\u8d25")}})};
n.bind("change",function(){""!=$(this).val()&&e.openWindow(this.files)})};
